{"project": "luigi", "bug": 12, "project_url": "https://github.com/spotify/luigi", "file_changed": "luigi/contrib/hdfs/clients.py", "buggy_commit_id": "c3119757c9ad4141fb446554109fa09cbd31173c", "fixed_commit_id": "b3e9ad57f8502a390686957b69070105fddcfd49", "lines_deleted": {"21": "\n", "28": "import logging\n", "33": "def get_autoconfig_client():\n", "37": "    configured_client = hdfs_config.get_configured_hdfs_client()\n", "38": "    if configured_client == \"webhdfs\":\n", "39": "        return hdfs_webhdfs_client.WebHdfsClient()\n", "40": "    if configured_client == \"snakebite\":\n", "41": "        return hdfs_snakebite_client.SnakebiteHdfsClient()\n", "42": "    if configured_client == \"snakebite_with_hadoopcli_fallback\":\n", "43": "        return luigi.contrib.target.CascadingClient([hdfs_snakebite_client.SnakebiteHdfsClient(),\n", "44": "                                                     hdfs_hadoopcli_clients.create_hadoopcli_client()])\n", "45": "    if configured_client == \"hadoopcli\":\n", "46": "        return hdfs_hadoopcli_clients.create_hadoopcli_client()\n", "47": "    raise Exception(\"Unknown hdfs client \" + configured_client)\n"}, "lines_added": {"21": "import logging\n", "22": "import threading\n", "32": "_AUTOCONFIG_CLIENT = threading.local()\n", "33": "\n", "35": "def get_autoconfig_client(client_cache=_AUTOCONFIG_CLIENT):\n", "39": "    try:\n", "40": "        return client_cache.client\n", "41": "    except AttributeError:\n", "42": "        configured_client = hdfs_config.get_configured_hdfs_client()\n", "43": "        if configured_client == \"webhdfs\":\n", "44": "            client_cache.client = hdfs_webhdfs_client.WebHdfsClient()\n", "45": "        elif configured_client == \"snakebite\":\n", "46": "            client_cache.client = hdfs_snakebite_client.SnakebiteHdfsClient()\n", "47": "        elif configured_client == \"snakebite_with_hadoopcli_fallback\":\n", "48": "            client_cache.client = luigi.contrib.target.CascadingClient([\n", "49": "                hdfs_snakebite_client.SnakebiteHdfsClient(),\n", "50": "                hdfs_hadoopcli_clients.create_hadoopcli_client(),\n", "51": "            ])\n", "52": "        elif configured_client == \"hadoopcli\":\n", "53": "            client_cache.client = hdfs_hadoopcli_clients.create_hadoopcli_client()\n", "54": "        else:\n", "55": "            raise Exception(\"Unknown hdfs client \" + configured_client)\n", "56": "        return client_cache.client\n"}}